# üìç PHASE 2: Stage Prompts Design

**Priority:** ‚≠ê‚≠ê‚≠ê (HIGH)
**Estimated Time:** 6-8 hours
**Dependencies:** Phase 0 (Translation) + Phase 1 (Stages finalized)

---

## üéØ Phase 2 Objectives

1. Design user guidance for every stage (what user should know)
2. Create AI prompts for every stage (what AI should generate)
3. Define output format for each stage (selection list, full text, etc.)
4. Handle user input (incorporate user's thoughts into AI prompt)
5. Ensure all prompts are in English (translation handled by Phase 0)
6. Create comprehensive prompt library

---

## üì¶ Phase 2 Deliverables

| # | Deliverable | Type | Location |
|---|-------------|------|----------|
| 1 | Stage Prompts Configuration | TypeScript | `config/stagePrompts.ts` |
| 2 | Prompt Templates Library | TypeScript | `config/promptTemplates.ts` |
| 3 | Stage Metadata | TypeScript | `config/stageMetadata.ts` |
| 4 | Updated Gemini Service | TypeScript | `services/geminiService.ts` |

---

## üß© Understanding Output Types

Before writing prompts, understand the 4 output types:

### Type 1: Selection List
**Use when:** User needs to choose from multiple options

**Example Stages:**
- CORE_CONCEPT_IDEA_TITLE (choose startup name)
- BRANDING_NAME (choose brand name)
- BRANDING_TAGLINE (choose tagline)

**AI Output Format:**
```
1. Option Name - Brief one-line description
2. Option Name - Brief one-line description
3. Option Name - Brief one-line description
...
```

**User Action:** Select one option or edit

---

### Type 2: Full Text
**Use when:** User needs a complete paragraph/document

**Example Stages:**
- CORE_CONCEPT_IDEA_ABSTRACT (full description)
- CORE_CONCEPT_PROBLEM_STATEMENT (problem explanation)
- BRANDING_VISION (vision statement)

**AI Output Format:**
```
[Complete paragraph or multiple paragraphs]
```

**User Action:** Accept, edit, or reject

---

### Type 3: Structured List
**Use when:** User needs itemized list

**Example Stages:**
- CORE_CONCEPT_BUSINESS_GOALS (list of goals)
- PRODUCT_DEV_CORE_FEATURES (list of features)
- MARKETING_MEASUREMENT_KPIS (list of metrics)

**AI Output Format:**
```
- Item 1
- Item 2
- Item 3
...
```

**User Action:** Accept, add/remove items, or edit

---

### Type 4: Analysis
**Use when:** User needs in-depth analysis with multiple sections

**Example Stages:**
- MARKET_ANALYSIS_SIZE (TAM/SAM/SOM analysis)
- MARKET_ANALYSIS_COMPETITOR_ANALYSIS (detailed comparison)
- ORGANIZATION_FINANCIAL_PROJECTIONS (financial forecasts)

**AI Output Format:**
```
## Section 1
[Analysis content]

## Section 2
[Analysis content]

[Tables, numbers, structured data]
```

**User Action:** Review and accept

---

## üîß Phase 2 Implementation Steps

### Step 2.1: Create Stage Metadata

**File:** `config/stageMetadata.ts`

**Purpose:** Basic information about each stage

```typescript
/**
 * Stage Metadata
 * Basic categorization and configuration for each stage
 */

import { Stage } from '../types';

export type OutputType = 'selection_list' | 'full_text' | 'structured_list' | 'analysis';

export interface StageMetadata {
    stage: Stage;
    phase: string;
    outputType: OutputType;
    isAutoGenerated: boolean; // Does AI generate without user asking?
    isSummary: boolean; // Is this a summary stage?
    estimatedTime: string; // How long this stage typically takes
}

export const STAGE_METADATA: Record<Stage, StageMetadata> = {
    [Stage.CORE_CONCEPT_IDEA_TITLE]: {
        stage: Stage.CORE_CONCEPT_IDEA_TITLE,
        phase: 'Core Concept',
        outputType: 'selection_list',
        isAutoGenerated: false,
        isSummary: false,
        estimatedTime: '5-10 minutes'
    },

    [Stage.CORE_CONCEPT_IDEA_ABSTRACT]: {
        stage: Stage.CORE_CONCEPT_IDEA_ABSTRACT,
        phase: 'Core Concept',
        outputType: 'full_text',
        isAutoGenerated: false,
        isSummary: false,
        estimatedTime: '10-15 minutes'
    },

    // ... continue for all 114+ stages
};
```

---

### Step 2.2: Create Prompt Templates

**File:** `config/promptTemplates.ts`

**Purpose:** Reusable prompt building blocks

```typescript
/**
 * Prompt Templates
 * Reusable components for building stage-specific prompts
 */

export const PROMPT_INSTRUCTIONS = {
    // Common instructions
    NO_PREAMBLE: 'NO introduction, NO greetings, NO "here is..." phrases.',
    BE_CONCISE: 'Be concise and direct.',
    BE_ACTIONABLE: 'Provide actionable and specific suggestions.',
    USE_EXAMPLES: 'Include relevant examples when helpful.',

    // Format-specific
    NUMBERED_LIST: 'Format as a numbered list (1., 2., 3., ...).',
    BULLET_LIST: 'Format as a bulleted list (-, *, or ‚Ä¢).',
    ONE_LINE_DESC: 'Each item should have a brief one-line description.',
    PARAGRAPH_FORMAT: 'Write in clear paragraphs.',

    // Content-specific
    BASED_ON_IDEA: 'Base your response on the startup idea: "{initialIdea}"',
    BASED_ON_USER_INPUT: 'User\'s input: "{userInput}"\n\nBased on this input,',
    CONSIDER_CONTEXT: 'Consider the following context: {context}',
};

export const SYSTEM_INSTRUCTIONS = {
    STARTUP_MENTOR: 'You are an AI startup mentor helping entrepreneurs develop their business ideas.',
    BE_PROFESSIONAL: 'Maintain a professional yet encouraging tone.',
    BE_PRACTICAL: 'Focus on practical, implementable advice.',
    USE_LANGUAGE: 'Always respond in {language}.',
};

// Template builders
export const buildSystemInstruction = (language: string = 'English'): string => {
    return `${SYSTEM_INSTRUCTIONS.STARTUP_MENTOR} ${SYSTEM_INSTRUCTIONS.BE_PROFESSIONAL} ${SYSTEM_INSTRUCTIONS.BE_PRACTICAL} ${SYSTEM_INSTRUCTIONS.USE_LANGUAGE.replace('{language}', language)}`;
};

export const buildSelectionListPrompt = (
    question: string,
    count: number,
    itemDescription: string
): string => {
    return `${question}

${PROMPT_INSTRUCTIONS.NUMBERED_LIST}
${PROMPT_INSTRUCTIONS.ONE_LINE_DESC}
Provide exactly ${count} options.

Example format:
1. Option Name - Brief description
2. Option Name - Brief description
...

${PROMPT_INSTRUCTIONS.NO_PREAMBLE}`;
};
```

---

### Step 2.3: Create Stage Prompts Configuration

**File:** `config/stagePrompts.ts`

**Purpose:** Complete guidance and prompts for each stage

```typescript
/**
 * Stage Prompts Configuration
 * User guidance and AI prompts for every stage
 */

import { Stage } from '../types';
import { StartupData } from '../types';

export interface UserGuidance {
    title: string;              // Stage title
    description: string;        // What is this stage about?
    goal: string;              // What should user achieve?
    question: string;          // Question to ask user
    tips: string[];            // Key considerations
    examples?: string[];       // Optional examples
}

export interface AIPromptConfig {
    // Prompt when user provides input
    withUserInput: (userInput: string, startupData: Partial<StartupData>) => string;

    // Prompt when user doesn't provide input
    withoutUserInput: (startupData: Partial<StartupData>) => string;

    // System instruction (optional override)
    systemInstruction?: string;
}

export interface StagePromptConfig {
    userGuidance: UserGuidance;
    aiPrompt: AIPromptConfig;
}

// Main configuration object
export const STAGE_PROMPTS: Partial<Record<Stage, StagePromptConfig>> = {
    // ========================================
    // PHASE 1: CORE CONCEPT
    // ========================================

    [Stage.CORE_CONCEPT_IDEA_TITLE]: {
        userGuidance: {
            title: "Choose Your Startup Name",
            description: "Choosing the right name for your startup is crucial. Your name is the first impression and should reflect your brand identity, be memorable, and resonate with your target audience.",
            goal: "Select a unique, memorable, and relevant name for your startup.",
            question: "What is your startup name?",
            tips: [
                "Make it unique and not already taken by competitors",
                "Keep it short, simple, and easy to pronounce",
                "Ensure it's relevant to your business and industry",
                "Avoid local or cultural-specific names if targeting global markets",
                "Check domain name availability",
                "Consider trademark availability",
                "Test pronunciation in different languages if going global"
            ],
            examples: [
                "Uber - Simple, short, implies getting around",
                "Airbnb - Air bed and breakfast, descriptive",
                "Stripe - Clean, simple, payment-related imagery"
            ]
        },
        aiPrompt: {
            withUserInput: (userInput, startupData) => `
User's initial idea for the name: "${userInput}"
Startup concept: "${startupData.initialIdea || 'Not specified'}"

Based on the user's input and the startup concept, suggest 5-7 startup names.

Format:
1. Name - Brief one-line description explaining the name choice
2. Name - Brief one-line description explaining the name choice
...

Requirements:
- Keep names short (1-2 words preferred)
- Make them memorable and unique
- Ensure relevance to the business
- Consider the user's initial idea as a starting point
- NO introduction or explanations
- ONLY the numbered list of names with descriptions
            `.trim(),

            withoutUserInput: (startupData) => `
Startup concept: "${startupData.initialIdea || 'Not specified'}"
Problem being solved: "${startupData.coreConcept_problemStatement || 'Not specified'}"
Target audience: "${startupData.coreConcept_initialTargetAudience || 'Not specified'}"

Suggest 5-7 creative and relevant startup names based on the concept above.

Format:
1. Name - Brief one-line description explaining the name choice
2. Name - Brief one-line description explaining the name choice
...

Requirements:
- Keep names short (1-2 words preferred)
- Make them memorable and unique
- Ensure relevance to the business
- NO introduction or explanations
- ONLY the numbered list of names with descriptions
            `.trim()
        }
    },

    [Stage.CORE_CONCEPT_IDEA_ABSTRACT]: {
        userGuidance: {
            title: "Write Your Idea Abstract",
            description: "A well-written abstract provides a concise overview of your startup idea. It should clearly communicate what you're building, why it matters, and who it's for.",
            goal: "Create a clear, compelling summary of your startup idea in 100-150 words.",
            question: "Describe your startup idea in detail.",
            tips: [
                "Start with what problem you're solving",
                "Explain your solution clearly",
                "Mention who your target users are",
                "Keep it concise but comprehensive",
                "Avoid jargon and technical terms",
                "Make it understandable to anyone",
                "Focus on the value you provide"
            ],
            examples: [
                "Airbnb: A platform connecting travelers with local hosts offering unique accommodations, providing authentic travel experiences while helping hosts earn extra income."
            ]
        },
        aiPrompt: {
            withUserInput: (userInput, startupData) => `
User's description: "${userInput}"
Startup name: "${startupData.coreConcept_ideaTitle || 'Not specified'}"
Initial idea: "${startupData.initialIdea || 'Not specified'}"

Based on the user's description, write a polished abstract for this startup idea.

Requirements:
- Length: 100-150 words
- Include: problem, solution, target audience, value proposition
- Write in clear, professional language
- Make it compelling and easy to understand
- NO introduction, just the abstract itself
            `.trim(),

            withoutUserInput: (startupData) => `
Startup name: "${startupData.coreConcept_ideaTitle || 'Not specified'}"
Initial idea: "${startupData.initialIdea || 'Not specified'}"
Problem: "${startupData.coreConcept_problemStatement || 'Not specified'}"
Solution: "${startupData.coreConcept_proposedSolution || 'Not specified'}"

Write a comprehensive abstract for this startup idea.

Requirements:
- Length: 100-150 words
- Include: problem, solution, target audience, value proposition
- Write in clear, professional language
- Make it compelling and easy to understand
- NO introduction, just the abstract itself
            `.trim()
        }
    },

    [Stage.CORE_CONCEPT_PROBLEM_STATEMENT]: {
        userGuidance: {
            title: "Define the Problem",
            description: "Clearly articulating the problem you're solving is the foundation of your startup. A well-defined problem statement helps validate your idea and attracts investors.",
            goal: "Clearly explain the problem your startup addresses and why it matters.",
            question: "What problem are you solving?",
            tips: [
                "Be specific about who has this problem",
                "Quantify the problem if possible (how many people affected?)",
                "Explain current solutions and their limitations",
                "Describe the pain points in detail",
                "Show why this problem matters (impact, cost, frequency)",
                "Use real examples or scenarios",
                "Avoid being too broad or vague"
            ]
        },
        aiPrompt: {
            withUserInput: (userInput, startupData) => `
User's problem description: "${userInput}"
Startup idea: "${startupData.initialIdea || 'Not specified'}"
Target audience: "${startupData.coreConcept_initialTargetAudience || 'Not specified'}"

Based on the user's input, create a comprehensive problem statement.

Structure:
1. Who has the problem?
2. What is the problem?
3. Why does it matter?
4. What are current limitations/pain points?

Requirements:
- Write 2-3 clear paragraphs
- Be specific and detailed
- Use concrete examples if applicable
- NO introduction, just the problem statement
            `.trim(),

            withoutUserInput: (startupData) => `
Startup idea: "${startupData.initialIdea || 'Not specified'}"
Target audience: "${startupData.coreConcept_initialTargetAudience || 'Not specified'}"
Proposed solution: "${startupData.coreConcept_proposedSolution || 'Not specified'}"

Create a comprehensive problem statement based on the startup idea.

Structure:
1. Who has the problem?
2. What is the problem?
3. Why does it matter?
4. What are current limitations/pain points?

Requirements:
- Write 2-3 clear paragraphs
- Be specific and detailed
- Use concrete examples if applicable
- NO introduction, just the problem statement
            `.trim()
        }
    },

    // Continue for ALL stages...

    // Example of STRUCTURED_LIST type:
    [Stage.CORE_CONCEPT_BUSINESS_GOALS]: {
        userGuidance: {
            title: "Define Your Business Goals",
            description: "Set clear, measurable business goals using the SMART framework (Specific, Measurable, Achievable, Relevant, Time-bound).",
            goal: "Create 5-7 SMART business goals for your startup.",
            question: "What are your key business goals?",
            tips: [
                "Make goals specific and quantifiable",
                "Set realistic timelines (6 months, 1 year, 3 years)",
                "Include both financial and non-financial goals",
                "Consider user acquisition, revenue, market share",
                "Align goals with your vision and mission",
                "Make them measurable so you can track progress"
            ]
        },
        aiPrompt: {
            withUserInput: (userInput, startupData) => `
User's goals: "${userInput}"
Startup: "${startupData.coreConcept_ideaTitle || 'Not specified'}"
Vision: "${startupData.branding_vision || 'Not specified'}"

Based on user input, create a list of SMART business goals.

Format (for each goal):
- Goal: [Clear statement]
  Metric: [How to measure]
  Timeline: [When to achieve]

Provide 5-7 goals.
NO introduction, ONLY the formatted list.
            `.trim(),

            withoutUserInput: (startupData) => `
Startup: "${startupData.coreConcept_ideaTitle || 'Not specified'}"
Idea: "${startupData.initialIdea || 'Not specified'}"
Vision: "${startupData.branding_vision || 'Not specified'}"

Create a list of SMART business goals for this startup.

Format (for each goal):
- Goal: [Clear statement]
  Metric: [How to measure]
  Timeline: [When to achieve]

Provide 5-7 goals covering:
- Revenue/financial
- User acquisition
- Product development
- Market position
- Team growth

NO introduction, ONLY the formatted list.
            `.trim()
        }
    },

    // Example of ANALYSIS type:
    [Stage.MARKET_ANALYSIS_SIZE]: {
        userGuidance: {
            title: "Analyze Market Size",
            description: "Understanding your market size helps validate your business opportunity and attract investors. Calculate TAM (Total Addressable Market), SAM (Serviceable Addressable Market), and SOM (Serviceable Obtainable Market).",
            goal: "Estimate your market size using TAM/SAM/SOM framework.",
            question: "What is the size of your target market?",
            tips: [
                "TAM: Total market demand (if you had 100% market share)",
                "SAM: Portion you can realistically serve (geographic, segment)",
                "SOM: Portion you can capture in near term (3-5 years)",
                "Use industry reports, statistics, and research",
                "Show your calculation methodology",
                "Be realistic, not overly optimistic",
                "Compare to similar startups if possible"
            ]
        },
        aiPrompt: {
            withUserInput: (userInput, startupData) => `
User's market analysis: "${userInput}"
Startup: "${startupData.coreConcept_ideaTitle || 'Not specified'}"
Industry: Based on idea "${startupData.initialIdea || ''}"

Based on user input and research, provide a detailed market size analysis.

Structure:
## Total Addressable Market (TAM)
[Calculation and explanation]

## Serviceable Addressable Market (SAM)
[Calculation and explanation]

## Serviceable Obtainable Market (SOM)
[Calculation and explanation]

## Market Insights
[Key findings and implications]

Requirements:
- Include estimated numbers (use research or reasonable estimates)
- Show calculation logic
- Cite sources when possible
- Be realistic
- NO introduction phrases
            `.trim(),

            withoutUserInput: (startupData) => `
Startup: "${startupData.coreConcept_ideaTitle || 'Not specified'}"
Idea: "${startupData.initialIdea || 'Not specified'}"
Target audience: "${startupData.coreConcept_initialTargetAudience || 'Not specified'}"
Geography: Assume global or specify if local

Research and provide a detailed market size analysis.

Structure:
## Total Addressable Market (TAM)
[Calculation and explanation]

## Serviceable Addressable Market (SAM)
[Calculation and explanation]

## Serviceable Obtainable Market (SOM)
[Calculation and explanation]

## Market Insights
[Key findings and implications]

Requirements:
- Include estimated numbers based on industry research
- Show calculation logic
- Cite sources when possible
- Be realistic
- Use latest available data
- NO introduction phrases
            `.trim()
        }
    }

    // ========================================
    // TODO: CONTINUE FOR ALL OTHER STAGES
    // ========================================
    //
    // This file will be very long (114+ stages)
    // Each stage needs:
    // 1. User guidance (title, description, goal, question, tips)
    // 2. AI prompt with user input
    // 3. AI prompt without user input
    //
    // Follow the patterns above for each output type:
    // - selection_list: Like CORE_CONCEPT_IDEA_TITLE
    // - full_text: Like CORE_CONCEPT_IDEA_ABSTRACT
    // - structured_list: Like CORE_CONCEPT_BUSINESS_GOALS
    // - analysis: Like MARKET_ANALYSIS_SIZE
};
```

**Note:** This file will be very long. You'll need to create entries for all 114+ stages.

---

### Step 2.4: Update Gemini Service

**File:** `services/geminiService.ts`

**Purpose:** Use the new stage-specific prompts

```typescript
import { STAGE_PROMPTS } from '../config/stagePrompts';
import { STAGE_METADATA } from '../config/stageMetadata';
import { Stage, StartupData, Locale } from '../types';

// Update buildPrompt function
const buildPrompt = (
    action: string,
    data: { stage: Stage; startupData: Partial<StartupData>; userInput?: string; locale: Locale }
): any => {
    const { stage, startupData, userInput, locale } = data;

    // Get stage-specific configuration
    const stageConfig = STAGE_PROMPTS[stage];

    if (!stageConfig) {
        // Fallback for stages without prompts yet
        return buildGenericPrompt(action, data);
    }

    // Determine which prompt to use
    const hasUserInput = userInput && userInput.trim().length > 0;
    const promptText = hasUserInput
        ? stageConfig.aiPrompt.withUserInput(userInput!, startupData)
        : stageConfig.aiPrompt.withoutUserInput(startupData);

    // Build Gemini API payload
    return {
        contents: [{
            parts: [{ text: promptText }]
        }],
        systemInstruction: {
            parts: [{
                text: stageConfig.aiPrompt.systemInstruction || buildSystemInstruction(locale)
            }]
        },
        generationConfig: {
            temperature: 0.7,
            topK: 40,
            topP: 0.95,
            maxOutputTokens: 2048,
        }
    };
};

// Helper for system instruction
const buildSystemInstruction = (locale: Locale): string => {
    const lang = locale === 'fa' ? 'Persian (Farsi)' : locale === 'ar' ? 'Arabic' : 'English';
    return `You are an AI startup mentor helping entrepreneurs develop their business ideas. Always respond in ${lang}. Be professional, practical, and encouraging.`;
};

// Fallback for stages without prompts
const buildGenericPrompt = (action: string, data: any): any => {
    // Use old logic as fallback
    // ...existing code...
};
```

---

## ‚úÖ Phase 2 Testing Checklist

- [ ] All stages have entries in STAGE_PROMPTS
- [ ] All stages have entries in STAGE_METADATA
- [ ] Prompts compile without TypeScript errors
- [ ] Test at least 5 different stages with AI
- [ ] Verify output format matches expectations
- [ ] Test with user input vs without user input
- [ ] Test in different languages (translation working)
- [ ] User guidance is clear and helpful
- [ ] Tips are actionable
- [ ] Examples are relevant

**Test a prompt:**

```typescript
import { STAGE_PROMPTS } from './config/stagePrompts';
import { Stage } from './types';

const config = STAGE_PROMPTS[Stage.CORE_CONCEPT_IDEA_TITLE];

console.log('User Guidance:', config.userGuidance);

const prompt = config.aiPrompt.withUserInput('NotifyMaster', {
    initialIdea: 'App to manage notifications'
});

console.log('AI Prompt:', prompt);
```

---

## üìä Phase 2 Success Criteria

‚úÖ **All stages have complete prompt configurations**
‚úÖ **Prompts generate expected output formats**
‚úÖ **User guidance is clear and helpful**
‚úÖ **Prompts work with and without user input**
‚úÖ **Translation system integrates smoothly**

---

## üéØ Ready for Phase 3?

Once all prompts are written and tested:

‚úÖ **Move to Phase 3: UI/UX Integration**

---
